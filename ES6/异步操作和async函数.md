---
title: 异步操作和async函数
tags: 前端
---
### 关于异步
ES6诞生前，异步编程的方法大概有下面4面
* 回调函数
* 事件监听
* 发布\订阅
* Promise对象

ES7中的async函数更是给出了异步编程的终极解决办法。

## 基本概念
#### 异步
所谓“异步”，简单说就是一个任务分成两段，先执行第一段，然后转而执行其他任务，等做好准备再回头执行第二段。
比如，有一个任务是读取文件进行操作，任务的第一段是向操作系统发出请求，要求读取文件。然后，程序执行其他任务，等到操作系统返回文件，再接着执行任务的第二段（处理文件）。这种不连续的执行，就叫做异步。
相应地，连续的执行就叫作同步。由于是连续执行，不能插入其他任务，所以操作系统从硬盘读取文件的这段时间，程序只能等待。

#### 回调函数
JS对异步的实现就是回调函数。所谓回调函数，就是把任务的第二段单独写在一个函数中，等到重新执行该任务时直接调用这个函数。callback直译过来就是“重新调用”

读取文件例子：
```javascript
fs.readFile('xxoo', function(err, data){
	if(err){
		throw err;
	}
	console.log(data);
})
```
上面代码中。readFile函数的第二个参数就是回调函数，也就是任务的第二段。等到操作系统返回了xxoo这个文件以后，回调函数才会执行。

一个有趣的问题，为什么Node.js约定回调函数的第一个参数必须是错误对象err（如果没有错误，该参数就是null），原因就是执行分成两段，在这两段之间抛出的错误程序无法捕获，只能当作参数传入第二段。

#### Promise
回调函数本身并没有问题，问题出在多重嵌套，会出现回调函数地狱
Promise就是为了解决这个问题而提出的。它不是新的语法功能，而是一个新的写法，允许将回调函数的横向加载改成纵向加载。采用Promise，连续读取多个文件的写法如下：
```javascript

```

